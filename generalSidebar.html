<div id="generalSidebar" class="tabcontent">
   <!--separator-->
   <div class="block"></div>
   <? var properties = PropertiesService.getDocumentProperties() ?>
      The options below allow you to manually link new files.
      You should be sure the columns match those of the default files provided during setup.<br>
      <strong>Results are not guaranteed.</strong><br>
    <div class="block">
      The Purchase Spreadsheet will be linked to the New Purchase Order form. All purchases will be logged in this sheet.
      If you link a new sheet, you must manually link the purchase form.<br>
      <button id="file-purchase-sheet" onclick="openPickerWindow('file-purchase-sheet', 's')">Link Purchase Spreadsheet</button>
      <? var id = properties.getProperty('file-purchase-sheet');
       var link = "";
       if (id != null)
      {
        link = "https://docs.google.com/spreadsheets/d/" + id;?>
        <a href="<?=link?>">Open Sheet</a>
      <?}?>
    </div>
    <div class="block">
      The PO template should be a blank purchase order form. For technical reasons, it is much simpler to copy an existing file than to create a new one.<br>
      <button id="file-po-template" onclick="openPickerWindow('file-po-template', 's')">Link PO Template</button>
      <?var id = properties.getProperty('file-po-template');
      if (id != null)
      {
        link = "https://docs.google.com/spreadsheets/d/" + id;?>
        <a href="<?=link?>">Open Sheet</a>
      <?}?>
    </div>
    <div class="block" id="button-bar">
      New purchase orders will be saved to this folder.<br>
      <button id="folder-po" onclick="openPickerWindow('folder-po', 'f')">Select PO Destination Folder</button>
      <?var id = properties.getProperty('folder-po');
      if (id != null)
      {
        link = "https://drive.google.com/drive/u/0/folders/" + id;?>
        <a href="<?=link?>">Open Folder</a>
      <?}?>
    </div>
    <div class="block">
    <!--REMOVE BEFORE PRODUCTION-->
    <p>Remove <strong>all</strong> configuration data for this spreadsheet. Don't press unless you know what this does.</p>
    <button id="reset" class="red" onclick="reset()">Reset</button>
    </div>
</div>

<script>
  /** FOR SOME REASON THIS DOES NOT GET CALLED WHEN IT SHOULD
   */
function reset()
{
  this.disabled=true;
  google.script.run
  .withSuccessHandler(function() {
    showInfo("Successfully reset configuration");
  })
  .withFailureHandler(function () {
    showError("Failed to reset configuration")
  })
  .withUserObject(this)
  .clearProperties();
}
  
  function openPickerWindow(paramName, type)
  {
    this.disabled = true;
    google.script.run
    .withSuccessHandler(
      function(msg, element) {
        showInfo("Opening picker window");
        element.disabled = false;
      })
    .withFailureHandler(
      function(msg, element) {
        showError(msg);
        element.disabled = false;
      })
    .withUserObject(this)
    .showPicker(paramName, type, false);
  }
  
  function openById(name)
  {
    var properties = PropertiesService.getDocumentProperties();
    var id = properties.getProperty(name);
    if (id == null)
    {
      showError("openById called on nonexistent document property " + name);
    }
  }
</script>