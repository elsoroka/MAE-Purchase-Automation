<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <!-- The CSS package above applies Google styling to buttons and other elements. -->
    <!-- "Googly" theme CSS to fix tabs. Comes from https://stackoverflow.com/questions/38052215/how-to-make-html-tabs-match-googles-css-spec-for-add-ons -->
    <link rel="stylesheet" href="https://cdn.rawgit.com/mogsdad/e13b618322ec87ca8d28/raw/f1f96f797dadf968276c63de4df0bb04fb80646f/googly-jquery-ui.css">

  <?!= include('style'); ?>
  
  </head>
  <style>
  div.sidebar-branding-below
  {
    position:relative;
  }
  div.message
  {
    padding-top:12px
  }
  
  </style>
  <body>
  <?var properties = PropertiesService.getDocumentProperties();?>
    <!-- Tab links -->
    <div class="tab" id="tabs">
      <ul>
      <?if (properties.getProperty("system-enable") != null) // Document properties were found; this is a valid system
      {?>
        <li><a href="#generalSidebar" id="default">General</a></li>
        <li><a href="#slackSidebar">Slack</a></li>
        <li><a href="#emailSidebar">Email</a></li>
      <?}
      else
      {?>
        <li><a href="#fileSidebar" id="default">Setup</a></li>
      <?}?>
      </ul>
    <div class="sidebar-branding-below" id="content">
      <?if (properties.getProperty("system-enable") != null) // Document properties were found; this is a valid system
      {?>
      <?!= includeTemplate('generalSidebar'); ?>
      <?!= include('slackSidebar'); ?>
      <?!= includeTemplate('emailSidebar'); ?>
      <?}
      else
      {?>
      <?!= includeTemplate('setupSidebar'); ?>
      <?}?>
    </div>
    <div class="message" id="message">
      <!--errors and info goes here-->
      <div class="error" id="error">
      </div>
      <div class="info" id="info">
      </div>
    </div>
    </div>
  </body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<script>

/**
 * Set up tabs on page load
 */
$(function()
{
  $( "#tabs" ).tabs();
});

// Open the default tab
//document.getElementById("default").click();

function loadTab(name)
{
  var tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  document.getElementById(name).style.display = "block";
}

/** Expects: the prefs object with list of strings and list of checkboxes
 * returned by getPrefs()
 */
function loadPrefs(prefs)
{
  for (var key in prefs.strings)
  {
    $("#"+key).val(prefs.strings[key]);
  }
  for (var key in prefs.checkboxes)
  {
    $('#'+key).attr('checked', (prefs.checkboxes[key]=="true"));
  }
}

/** Expects: the prefs object with list of strings and list of checkboxes
 * returned by getPrefs(). Saves this to the properties service.
 */
function savePrefs(propKeys)
{
  this.disabled = true;
  var props = {strings:{}, checkboxes:{}};
  var msg = "\n";
  for (var i=0; i<propKeys.strings.length; ++i) // retrieve values from textfields
  {
    props.strings[propKeys.strings[i]] = $("#"+propKeys.strings[i]).val();
    msg += " " + propKeys.strings[i] + " ";
  }
  for (var i=0; i<propKeys.checkboxes.length; ++i) // retrieve values from checkboxes
  {
    props.checkboxes[propKeys.checkboxes[i]] = $('#'+propKeys.checkboxes[i]).is(':checked');
    msg += " " + propKeys.checkboxes[i] + " ";
  }
  google.script.run.saveProps(props);
  showInfo("Saved configuration" + msg);
}

/**
 * Displays an error or info message in the message div
 *
 * @param {string} msg The error message to display.
 * @param {DOMElement} element The element after which to display the error. (Unused, should remove)
 */
function showError(msg)
{
  var error = document.getElementById("error");
  error.innerHTML = msg;
}
// Show info message
function showInfo(msg)
{
  var info = document.getElementById("info");
  info.innerHTML = msg;
}
</script>
