
      <div id="slackSidebar" class="tabcontent">
      <form>
      
        <div class="block form-group">
          <input type="checkbox" id="slack-enable">
          <label for="slack-enable" value="true">Enable Slack</label>
          
          <div>
            <label class="description" for="slack-webhook">Slack Webhook </label>
			<textarea class="width-100" id="slack-webhook" rows="2"></textarea>
          </div>
          <div>
            <label class="description" for="slack-channel">Channel </label>
			<input id="slack-channel" name="slack-channel" class="element text medium" type="text" maxlength="255" value=""/> 
          </div>
          <div>
            <label class="description" for="slack-name">PO Bot Name </label>
			<input id="slack-name" name="slack-name" class="element text medium" type="text" maxlength="255" value=""/> 
          </div>
          <div>
            <label class="description" for="slack-icon">PO Bot Icon </label>
			<input id="slack-icon" name="slack-icon" class="element text medium" type="text" maxlength="255" value=""/> 
          </div>
          <div>
            <label class="description" for="slack-color">Message Color </label>
			<input id="slack-color" name="slack-color" class="element text medium" type="text" maxlength="255" value=""/> 
          </div>
          <div>
            <label class="description" for="slack-fallback">Message Fallback </label>
			<textarea class="width-100" id="slack-fallback" rows="2"></textarea> 
          </div>
          <div>
            <label class="description" for="slack-pretext">Message Pretext </label>
			<textarea class="width-100" id="slack-pretext" rows="2"></textarea> 
          </div>
          
        </div>
        
        <div class="block" id="button-bar">
          <button id="slack-test">Test</button>
          <button id="slack-save">Save</button>
          <button id="picker">Picker</button>
        </div>

      </form>
      </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
    
    // AUGH a global variable
    var slack_string_params = ["slack-webhook", "slack-channel", "slack-name", "slack-icon", "slack-color", "slack-fallback", "slack-pretext"];

    /**
    * Reference:
    * https://developers.google.com/gsuite/add-ons/editors/docs/quickstart/translate
    */
    
      /**
       * On document load, assign click handlers to each button and try to load the
       * user's preferences if they exist
       */
      $(function() {
        $('#slack-test').click(slackTest); // Test Slack settings
        $('#slack-save').click(slackSave); // Save Slack settings
        $('#picker').click(pickerTest);
        google.script.run.withSuccessHandler(slackLoadPrefs)
            .withFailureHandler(showError).slackGetPrefs();
      });

      /**
      * Make a test Slack post
      */
      function slackTest()
      {
        this.disabled = true;
        $('#error').remove();
        $('#info').remove();
        google.script.run
            .withSuccessHandler(
              function(msg, element) {
                showInfo(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withFailureHandler(
              function(msg, element) {
                showError(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withUserObject(this)
            .slackTestPost($('#slack-webhook').val(),
              $('#slack-channel').val(),
              $('#slack-name').val(),
              $('#slack-icon').val(),
              "PO 2.0 test message");
      }
      
      function slackSave()
      {
        this.disabled = true;
        $('#error').remove();
        $('#info').remove();
        var slackPrefs = {'slack-enable':$('#slack-enable').is(':checked')};
        for (i=0; i<slack_string_params.length; ++i)
        {
          slackPrefs[slack_string_params[i]] = $("#"+slack_string_params[i]).val();
        }
        google.script.run
            .withSuccessHandler(
              function(msg, element) {
                showInfo("Configuration saved!", $('#button-bar'));
                element.disabled = false;
              })
            .withFailureHandler(
              function(msg, element) {
                showError(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withUserObject(this)
            .slackSavePrefs(slackPrefs);
      }
      
      function slackLoadPrefs(prefs) // the parameter to this is the object returned by slackGetPrefs()
      {
        for (i=0; i<slack_string_params.length; ++i)
        {
          $("#"+slack_string_params[i]).val(prefs[slack_string_params[i]]);
        }
        if (prefs['slack-enable']=="true") // horrible code
        {
          $('#slack-enable').attr('checked', true);
        }
        showInfo("Loaded preferences", "#button-bar");
      }

      
      function pickerTest()
      {
          this.disabled = true;
          google.script.run
            .withSuccessHandler(
              function(msg, element) {
                showInfo("picker open!", $('#button-bar'));
                element.disabled = false;
              })
            .withFailureHandler(
              function(msg, element) {
                showError(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withUserObject(this)
            .showPicker();
      }
    </script>